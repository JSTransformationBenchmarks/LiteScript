#!/bin/bash

set -e

VERSION=$1
if [ "$VERSION" = "" ]; then 
    echo "missing parameter, VERSION. e.g.: copy-to-main 0.7"
    exit 1
fi

CWD=$(pwd)

#get main source folder: /source
cd "../.."
MAIN=$(pwd)
cd -

#get devel source folder /devel/source-v${VERSION} 
cd ../source-v${VERSION} 
SRCVRS=$(pwd)
cd -

echo ---------------
echo UPDATE MAIN DIR: /source /lib
echo ---------------
echo "MAIN ${MAIN}"
echo "SRC VERSION ${SRCVRS}"
echo ---------------

echo COPY /out/lib to main dir /lib
mkdir -p ${MAIN}/lib
rm ${MAIN}/lib/*
cp -p out/lib/* ${MAIN}/lib/

# delete deleted
cd ${MAIN}/source
pwd
for file in *.md; do
    #echo ${file}
    if [ ! -e ${SRCVRS}/${file} ]; then 
        echo deleted: ${file}
        rm ${file}
    fi
done

# update newer sources
echo UPDATE /source 
echo from ${SRCVRS}/ to $(pwd)
cp -uvp ${SRCVRS}/*.lite.md .

cd ${CWD}

#update extras/sublime
mkdir -p ${MAIN}/extras/sublime/LiteScript
if [ -d /home/ltato/.config/sublime-text-2/Packages/LiteScript ]; then 
	cp -uvp /home/ltato/.config/sublime-text-2/Packages/LiteScript/* ${MAIN}/extras/sublime/LiteScript
    rm ${MAIN}/extras/sublime/LiteScript/*.cache
fi
